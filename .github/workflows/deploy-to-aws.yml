# AWS IAM JSON:
# {
#    "Statement": [
#        {
#            "Action": "s3:*",
#            "Resource": [
#                "arn:aws:s3:::craig.mayhew.io",
#                "arn:aws:s3:::craig.mayhew.io/*"
#            ],
#            "Effect": "Allow"
#        },
#        {
#            "Action": "cloudfront:CreateInvalidation",
#            "Resource": [
#                "arn:aws:cloudfront::ACCOUNTID:distribution/DISTRIBUTIONID"
#            ],
#            "Effect": "Allow"
#        },
#        {
#            "Effect": "Allow",
#            "Action": [
#                "cloudfront:ListDistributions"
#            ],
#            "Resource": "*"
#        },{
#            "Effect": "Allow",
#            "Action": [
#                "route53:ChangeResourceRecordSets",
#                "route53:ListResourceRecordSets"
#            ],
#            "Resource": "arn:aws:route53:::hostedzone/HOSTNAME"
#        },
#        {
#            "Effect": "Allow",
#            "Action": [
#                "route53:GetChange"
#            ],
#            "Resource": "arn:aws:route53:::change/*"
#        },
#        {
#            "Effect": "Allow",
#            "Action": "route53:ListHostedZonesByName",
#            "Resource": "*"
#        }
#    ]
#}

name: Deploy to AWS

on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@86f86b36ef15e6570752e7175f451a512eac206b
      - run: php --version
      - run: php tools/build.php && php tools/uploadToS3.php && echo "Deployed to S3"