{"_id":{"$id":"51feb420560e7051629da56d"},"date":"2009-07-07 12:49:46","content":"The new network manager is a massive improvement over the previous network tools in Ubuntu. Coming from a windows background I am used to routing tables being updated automatically. However, after connecting to a VPN using the Ubuntu 9.04 network manager I'm unable to access or even ping anything on the remote network, yet the VPN is connected. This is due to the computer not knowing about the computers on the VPN. This is where routing tables come into play. My works ip range is 192.168.10.* so this needs to be added to the routing table.\r\n\r\nThe easiest way to do this is to have the network manager handle it all by adding a setting in the network manager like so:\r\n\r\nClick on the network manager icon then \"VPN Connections\" and the following menu should appear: Click \"Configure VPN\".\r\n<img class=\"size-full wp-image-140\" title=\"Configure VPN\" src=\"\/uploads\/2009\/07\/Configure-VPN.jpg\" alt=\"Configure VPN\" width=\"186\" height=\"82\" \/>\r\n\r\nClick the VPN tab. The VPN you have already created should appear in the list. Click your VPN and then click edit.\r\n<img class=\"size-full wp-image-131\" title=\"Network Connections - Click Edit VPN\" src=\"\/uploads\/2009\/07\/Network-Connections-Click-Edit-VPN.jpg\" alt=\"Network Connections - Click Edit VPN\" width=\"525\" height=\"353\" \/>\r\n\r\nAnother window should appear, click the \"IPv4 Settings\" tab. Then click the \"Routes...\" button.\r\n<img class=\"size-full wp-image-132\" title=\"Network Connection - Edit VPN - IPV4 Settings - Click Routes\" src=\"\/uploads\/2009\/07\/Network-Connection-Edit-VPN-IPV4-Settings-Click-Routes.jpg\" alt=\"Network Connection - Edit VPN - IPV4 Settings - Click Routes\" width=\"440\" height=\"544\" \/>\r\n\r\nNow you need to add a route so your computer can talk to other computers on the VPN. In this case I have added the address as 192.168.10.0 as all computers on the office network have an IP that begins with \"192.168.10\" and a netmask of 255.255.255.0. The gateway is the IP of my home router, in this case my home router is \"10.11.12.1\".\r\n<img class=\"size-full wp-image-133\" title=\"Network Connection - Edit VPN - IPV4 Settings - Routes - Add Route\" src=\"\/uploads\/2009\/07\/Network-Connection-Edit-VPN-IPV4-Settings-Routes-Add-Route.jpg\" alt=\"Network Connection - Edit VPN - IPV4 Settings - Routes - Add Route\" width=\"534\" height=\"283\" \/>\r\n\r\nAt this point it's also worth mentioning as a side note that if \"Use this connection only for resources on its network\" is NOT ticked then all of your regular internet traffic will go via the VPN and not just when you want to access something on VPN like shared files and folders. This would really slow down your internet access. I personally would have this ticked.\r\n\r\nAnd there you have it, that will now allow your computer to talk to other computers on the office\/remote network.\r\n\r\nFor those of you who want a more hands on approach and really want to see whats going on behind the scenes (everyone else stop reading here):\r\n\r\nRun the route command to view the routing table:\r\n<pre style=\"border: 1px solid #FFFFFF; padding: 5px; overflow:auto;\">route<\/pre>\r\nThis is the route table with the missing route:\r\n<pre style=\"border: 1px solid #FFFFFF; padding: 5px; overflow:auto;\">Kernel IP routing table\r\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\r\noffice.mywork   my.router       255.255.255.255 UGH   0      0        0 eth2\r\n10.11.0.0       *               255.255.0.0     U     1      0        0 eth2\r\nlink-local      *               255.255.0.0     U     1000   0        0 eth2\r\ndefault         my.router       0.0.0.0         UG    0      0        0 eth2<\/pre>\r\nThe network manager automatically adds the correct route to the routing table when the VPN connection is created. You can achieve the same result with the following command. In this case we are using the network range 192.168.10.*:\r\n<pre style=\"border: 1px solid #FFFFFF; padding: 5px; overflow:auto;\">sudo route add -net 192.168.10.0\/24 ppp0<\/pre>\r\nNow check the routes table again:\r\n<pre style=\"border: 1px solid #FFFFFF; padding: 5px; overflow:auto;\">route<\/pre>\r\nAnd here we have a route that allows us to access computers on the remote network:\r\n<pre style=\"border: 1px solid #FFFFFF; padding: 5px; overflow:auto;\">Kernel IP routing table\r\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\r\noffice.mywork   10.11.12.1      255.255.255.255 UGH   0      0        0 eth2\r\n192.168.10.0    *               255.255.255.0   U     0      0        0 ppp0\r\n10.11.0.0       *               255.255.0.0     U     1      0        0 eth2\r\nlink-local      *               255.255.0.0     U     1000   0        0 eth2\r\ndefault         10.11.12.1      0.0.0.0         UG    0      0        0 eth2<\/pre>","title":"Fixing Ubuntu 9.04 VPN - Adding remote network to routing table","status":"publish","name":"fixing-ubuntu-9-04-vpn-adding-remote-network-to-routing-table","type":"","tags":["VPN Client","Ubuntu 9.04","Network Manager","Routing Table"],"categories":["Guides\/Fixes","Linux\/Ubuntu"],"comments":[{"author":"Anita","authorEmail":"48924@fhwn.ac.at","authorURL":"","authorIP":"77.118.108.22","timestamp":"2009-09-09 10:43:05","timestampGMT":"2009-09-09 09:43:05","comment":"Thank you! You saved my day!\r\nRegards, Anita","browser":"Opera\/9.80 (X11; Linux x86_64; U; en) Presto\/2.2.15 Version\/10.00"}]}